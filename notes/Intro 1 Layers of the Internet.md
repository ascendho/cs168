# Intro 1: Layers of the Internet

## 1. 互联网基础

### 1.1 互联网的定义与核心定位

- 本质：实现计算机（笔记本、手机、医疗设备等）间数据传输的基础设施，而非依赖其运行的应用（如谷歌、脸书）。
- 核心类比：邮政系统——课程聚焦“邮件传输基础设施”，而非“信件内容”。

### 1.2 互联网的重要性与设计挑战

#### 1.2.1 重要性

互联网重塑了商业、社交、学习、治理和医疗等多个领域，是现代社会的核心基础设施。

#### 1.2.2 核心设计挑战

- 联邦制（Federation）：无单一运营商，超10万个网络运营商需协作，需兼顾商业利益和技术兼容，创新需依赖普遍适配。
- 规模（Scale）：服务数十亿用户和万亿级网页，需支撑海量数据传输。
- 演进性（Evolution）：需求持续增长，技术需不断迭代适配。
- 多样性（Diversity）：用户数据需求、设备性能差异极大。
- 异步性（Asynchrony）：受光速限制，数据传输存在延迟，接收的数据已“过时”（例：4125公里传输需13.75毫秒，3GHz CPU可在此期间执行4200万次循环）。
- 容错性（Fault Tolerance）：依赖大量组件（线路、设备、软件），单组件99%可靠性下，50个组件的故障概率达39.5%，需支持大规模故障处理。

### 1.3 协议的核心概念

- 定义：通信的规范，包含语法（消息格式）、语义（消息响应动作）。
- 示例：课堂提问协议（举手→等待点名→提问→未被注意时提醒）。
- 标准化：由IETF（互联网工程任务组）通过RFC（请求评论）文档统一发布，确保全球兼容。

## 2. 互联网分层架构（核心内容）
互联网采用“分层抽象”设计，每一层依赖下一层的服务，为上一层提供服务，实现模块化解耦，降低设计复杂度。核心分为7层（实际常用5层，5-6层已过时），从下到上依次为：

### 2.1 底层架构（Layers 1-3）：实现基础数据传输
#### 2.1.1 物理层（Layer 1）：比特的空间传输
- 核心功能：通过物理技术将二进制比特（0/1）从一个地点传输到另一个地点。
- 常见技术：电线电压、光纤光信号、无线无线电波。
- 趣味案例：IPoAC（IPover Avian Carriers），通过信鸽传输IP数据（RFC 1149，愚人节提案），虽已实现但延迟高、丢包率55%。

#### 2.1.2 链路层（Layer 2）：本地网络构建
- 核心功能：利用物理层技术，构建本地网络，实现同一局部区域内设备的连接与数据包交换。
- 邮政类比：连接同一城镇内的所有家庭，形成本地通信网络。
- 关键概念：数据包（packet）——承载消息的一组比特。

#### 2.1.3 网络层（Layer 3）：跨网络互联
- 核心功能：连接多个本地网络（链路层），实现跨区域的全局数据传输，构成“网络的网络”。
- 邮政类比：在每个城镇设立邮局，仅连接邮局即可实现不同城镇间的通信，无需两两连接所有家庭。
- 核心组件：
  - 终端主机（Hosts）：通信的发起者和接收者（如笔记本、服务器），类比“家庭”。
  - 交换机/路由器（Switches/Routers）：接收并转发数据包，类比“邮局”。
- 核心特性：
  - 全局投递：数据包需经多跳（hop）、跨多种链路层协议（有线、无线、光纤）到达目的地。
  - 尽力而为（Best-Effort）：不保证数据包的交付、顺序和完整性，可能丢失、乱序或损坏，且不反馈交付状态。

### 2.2 上层架构（Layers 4-7）：提升传输可靠性与实现应用服务
#### 2.2.4 传输层（Layer 4）：可靠传输与连接管理
- 核心功能：基于网络层的全局投递服务，补充可靠性机制（如重传丢失数据包），将大数据分割为数据包并重组，形成“流（flow）”或“连接（connection）”。
- 核心价值：解决网络层“尽力而为”的缺陷，为上层提供可靠的端到端传输服务。

#### 2.2.5 应用层（Layer 7）：具体服务实现
- 核心功能：基于传输层的可靠连接，实现各类具体应用服务（如网页浏览、视频流、邮件）。
- 设计优势：同一底层基础设施可支撑多样化应用，无需为每个应用单独构建网络。

## 3. 头部信息（Headers）：数据包的“导航与说明”
### 3.1 头部的作用
数据包需携带元数据（头部），告知网络设备如何处理数据，类比“信件的信封”——信封上的信息指导邮件投递，信件内容为实际数据（ payload）。

### 3.2 常见头部字段
- 目的地址（Destination Address）：必备字段，指定数据包的最终接收者。
- 源地址（Source Address）：可选但常用，方便接收者回复。

### 3.3 头部的标准化
头部格式需全球统一（如“前8位为源地址，后8位为目的地址”），否则不同网络设备无法解析，导致通信失败。

## 4. 多头部机制：分层传输的实现
数据包在传输过程中，会随分层操作添加或剥离头部，不同设备（终端主机、路由器）处理的头部层级不同。

### 4.1 终端主机的多头部处理（仅端点）
- 发送端：数据从应用层向下传递时，每经过一层就添加该层的头部（如应用层→传输层添加传输层头部→网络层添加网络层头部→链路层添加链路层头部），最终以比特形式通过物理层发送。
- 接收端：数据从物理层向上传递时，每经过一层就剥离该层的头部，最终还原应用层数据。
- 核心特点：
  - 同层对等通信：某一层的头部仅被发送端和接收端的同层协议解析（如传输层头部仅由两端的传输层处理）。
  - 分层地址：不同层使用不同地址方案（如链路层地址对应本地设备，网络层地址对应全局终端，应用层地址对应具体应用）。

### 4.2 路由器参与的多头部处理
- 路由器功能：仅实现L1-L3层，不处理传输层（L4）和应用层（L7）的头部。
- 传输过程：
  1. 路由器接收数据包后，剥离链路层（L2）头部，解析网络层（L3）头部以确定下一跳路由。
  2. 为数据包添加新的链路层（L2）头部（适配下一跳的链路层协议），转发至下一个路由器或终端。
- 核心特点：
  - 链路层头部动态更新：每经过一个路由器，链路层头部会被替换为适配下一跳的格式。
  - 网络层头部不变：始终指向最终终端地址，确保全局投递方向正确。
  - 协议适配：不同链路可使用不同L2协议（有线、光纤、无线），路由器负责协议转换。

## 5. 核心总结
- 分层设计核心：模块化抽象，每层专注单一功能，降低复杂度，支持技术迭代（如替换L2协议不影响其他层）。
- 设备功能差异：终端主机实现L1-L7全层，路由器仅实现L1-L3。
- 头部作用：分层头部确保数据在不同层级的正确传输，链路层头部负责“局部跳转”，网络层头部负责“全局导航”，传输层和应用层头部负责“端到端可靠通信与服务识别”。
