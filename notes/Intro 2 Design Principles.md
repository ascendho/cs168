## Intro 2: Design Principles

### 一、互联网设计核心原则

互联网的设计遵循 7 条核心指导原则，并非绝对规则，却塑造了其核心架构：
1. 去中心化控制：无中央控制节点，路由器独立运行（SDN 为集中式替代方案，DSDN 又回归分布式）。
2. 尽力而为服务模型：第三层路由器仅提供基础交付，不做服务质量保障。
3. 绕开故障：网络具备弹性，链路或路由器故障时可自动寻找替代路径。
4.  dumb 基础设施+智能终端：路由器仅转发数据包，不解析内容（部分场景会解析 payload 检测攻击）。
5. 端到端原则：核心功能（如可靠性）需在端主机实现，而非路由器。
6. 分层架构：每层依赖下层、支撑上层，支持独立创新，不同群体可专注不同层级（如芯片设计者聚焦 1-2 层，应用开发者聚焦 7 层）。
7. 窄腰接口联邦：第三层仅用 IP 协议，所有主机和路由器统一支持，实现网络互联。

---

### 二、窄腰架构与多路分解

#### 1. 窄腰架构
- 互联网分层中，第一层（物理层）、第二层（链路层）、第四层（传输层）、第七层（应用层）均有多种协议可选。
- 第三层（网络层）仅保留 IP 协议，成为“窄腰”，统一所有网络设备的通信标准，保障全球网络联邦互通。

#### 2. 多路分解机制
- 核心目的：将接收的数据包准确传递到上层对应协议或应用。
- 第三层分解：通过数据包头部字段标识上层协议（如 TCP 或 UDP），使 IP 能精准转发。
- 第四层分解：通过端口号区分同一主机上的不同应用，端口号类似“房间号”，与 IP 地址配合定位通信目标。

#### 3. 端口的关键作用
- 端主机与服务器的端口分工：客户端使用随机端口，服务器使用固定的知名端口（如 HTTP 用 80 端口）。
- 注意区分：逻辑端口（软件层面标识应用）与物理端口（硬件层面插接口）。

#### 4. 端主机的层级实现
- 1-2层：由网络接口卡（NIC）硬件实现。
- 3-4层：由操作系统软件实现。
- 7层：由各类应用程序（如 Firefox、Zoom）实现。

---

### 三、端到端原则深度解析
#### 1. 核心问题
第三层为尽力而为服务，可靠性应在网络（路由器）还是端主机（如电脑）实现？

#### 2. 两种方案对比
- 方案1：网络层实现可靠性（路由器校验数据包完整性），无法保证正确性（如路由器故障误报成功，端主机无校验机制）。
- 方案2：端主机实现可靠性（接收方自行校验数据包），可独立保障正确性，无需依赖网络设备。

#### 3. 结论与例外
- 核心结论：端主机实现可靠性是唯一能保证正确性的方案，路由器的校验仅为冗余。
- 例外情况：可在路由器添加可靠性功能作为性能优化（如高丢包链路发送重复数据包），但必须配合端主机校验，不能替代。

---

### 四、资源共享设计
#### 1. 统计多路复用

- 核心逻辑：动态分配网络资源，根据用户实时需求调整，而非固定分配。
- 优势：比静态分配更高效，因为“总需求峰值 < 各用户峰值之和”（max(Σfi) < Σmax(fi)），避免资源闲置。
- 示例：Alice 早高峰需 10 单位资源，Bob 晚高峰需 10 单位，动态分配仅需 12 单位即可满足，静态分配则需 20 单位。

#### 2. 电路交换 vs 分组交换
两者均基于统计多路复用，核心差异体现在资源分配方式与性能表现：

| 对比维度                | 电路交换                          | 分组交换                          |
|-------------------------|-----------------------------------|-----------------------------------|
| 应用抽象性              | 更优，提供资源预留保障，行为可预测 | 较差，无保障，需应用适配          |
| 效率                    | 低，需 setup/teardown 时间，短流浪费严重 | 高，无需预留，适配突发流量（如网页浏览） |
| 故障处理                | 复杂，端主机需重新发起预留        | 简单，路由器自动切换路径，端主机无感知 |
| 实现复杂度              | 高，需处理预留确认、超时等问题    | 低，路由器无需跟踪连接状态        |

#### 3. 流量特性适配

- 平滑流量（如语音，峰值-平均比≈3:1）：电路交换与分组交换效率接近。
- 突发流量（如网页、邮件，峰值-平均比可达 100:1）：分组交换效率远超电路交换。

---

### 五、历史与总结
#### 1. 技术演进
- 早期互联网（1970s-1980s）：采用分组交换，适配突发文件传输需求。
- 1980s末-1990s：尝试转向电路交换，希望适配语音/电视等平滑流量，因突发流量主导而失败。
- 现状：分组交换为互联网默认方案，电路交换仅用于特定场景（如企业专线 MPLS、RSVP 协议）。

#### 2. 核心总结

- 架构层面：窄腰 IP 保障互联，分层与端到端原则支持创新与可靠性。
- 资源层面：统计多路复用提升效率，分组交换适配互联网主流突发流量。
- 关键机制：多路分解与端口协作，实现数据包精准投递。
